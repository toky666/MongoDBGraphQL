{"version":3,"file":"6973.js","mappings":"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","sources":["webpack://ruru/../../node_modules/monaco-editor/esm/vs/platform/instantiation/common/extensions.js","webpack://ruru/../../node_modules/monaco-editor/esm/vs/editor/common/services/languageFeatureDebounce.js","webpack://ruru/../../node_modules/monaco-editor/esm/vs/platform/instantiation/common/instantiation.js","webpack://ruru/../../node_modules/monaco-editor/esm/vs/platform/environment/common/environment.js","webpack://ruru/../../node_modules/monaco-editor/esm/vs/base/common/numbers.js","webpack://ruru/../../node_modules/monaco-editor/esm/vs/platform/instantiation/common/descriptors.js"],"sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nimport { SyncDescriptor } from './descriptors.js';\nconst _registry = [];\nexport function registerSingleton(id, ctorOrDescriptor, supportsDelayedInstantiation) {\n    if (!(ctorOrDescriptor instanceof SyncDescriptor)) {\n        ctorOrDescriptor = new SyncDescriptor(ctorOrDescriptor, [], Boolean(supportsDelayedInstantiation));\n    }\n    _registry.push([id, ctorOrDescriptor]);\n}\nexport function getSingletonServiceDescriptors() {\n    return _registry;\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nvar __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\nvar __param = (this && this.__param) || function (paramIndex, decorator) {\n    return function (target, key) { decorator(target, key, paramIndex); }\n};\nimport { doHash } from '../../../base/common/hash.js';\nimport { LRUCache } from '../../../base/common/map.js';\nimport { clamp, MovingAverage, SlidingWindowAverage } from '../../../base/common/numbers.js';\nimport { IEnvironmentService } from '../../../platform/environment/common/environment.js';\nimport { registerSingleton } from '../../../platform/instantiation/common/extensions.js';\nimport { createDecorator } from '../../../platform/instantiation/common/instantiation.js';\nimport { ILogService } from '../../../platform/log/common/log.js';\nimport { matchesScheme } from '../../../base/common/network.js';\nexport const ILanguageFeatureDebounceService = createDecorator('ILanguageFeatureDebounceService');\nvar IdentityHash;\n(function (IdentityHash) {\n    const _hashes = new WeakMap();\n    let pool = 0;\n    function of(obj) {\n        let value = _hashes.get(obj);\n        if (value === undefined) {\n            value = ++pool;\n            _hashes.set(obj, value);\n        }\n        return value;\n    }\n    IdentityHash.of = of;\n})(IdentityHash || (IdentityHash = {}));\nclass NullDebounceInformation {\n    constructor(_default) {\n        this._default = _default;\n    }\n    get(_model) {\n        return this._default;\n    }\n    update(_model, _value) {\n        return this._default;\n    }\n    default() {\n        return this._default;\n    }\n}\nclass FeatureDebounceInformation {\n    constructor(_logService, _name, _registry, _default, _min, _max) {\n        this._logService = _logService;\n        this._name = _name;\n        this._registry = _registry;\n        this._default = _default;\n        this._min = _min;\n        this._max = _max;\n        this._cache = new LRUCache(50, 0.7);\n    }\n    _key(model) {\n        return model.id + this._registry.all(model).reduce((hashVal, obj) => doHash(IdentityHash.of(obj), hashVal), 0);\n    }\n    get(model) {\n        const key = this._key(model);\n        const avg = this._cache.get(key);\n        return avg\n            ? clamp(avg.value, this._min, this._max)\n            : this.default();\n    }\n    update(model, value) {\n        const key = this._key(model);\n        let avg = this._cache.get(key);\n        if (!avg) {\n            avg = new SlidingWindowAverage(6);\n            this._cache.set(key, avg);\n        }\n        const newValue = clamp(avg.update(value), this._min, this._max);\n        if (!matchesScheme(model.uri, 'output')) {\n            this._logService.trace(`[DEBOUNCE: ${this._name}] for ${model.uri.toString()} is ${newValue}ms`);\n        }\n        return newValue;\n    }\n    _overall() {\n        const result = new MovingAverage();\n        for (const [, avg] of this._cache) {\n            result.update(avg.value);\n        }\n        return result.value;\n    }\n    default() {\n        const value = (this._overall() | 0) || this._default;\n        return clamp(value, this._min, this._max);\n    }\n}\nlet LanguageFeatureDebounceService = class LanguageFeatureDebounceService {\n    constructor(_logService, envService) {\n        this._logService = _logService;\n        this._data = new Map();\n        this._isDev = envService.isExtensionDevelopment || !envService.isBuilt;\n    }\n    for(feature, name, config) {\n        const min = config?.min ?? 50;\n        const max = config?.max ?? min ** 2;\n        const extra = config?.key ?? undefined;\n        const key = `${IdentityHash.of(feature)},${min}${extra ? ',' + extra : ''}`;\n        let info = this._data.get(key);\n        if (!info) {\n            if (this._isDev) {\n                this._logService.debug(`[DEBOUNCE: ${name}] is disabled in developed mode`);\n                info = new NullDebounceInformation(min * 1.5);\n            }\n            else {\n                info = new FeatureDebounceInformation(this._logService, name, feature, (this._overallAverage() | 0) || (min * 1.5), // default is overall default or derived from min-value\n                min, max);\n            }\n            this._data.set(key, info);\n        }\n        return info;\n    }\n    _overallAverage() {\n        // Average of all language features. Not a great value but an approximation\n        const result = new MovingAverage();\n        for (const info of this._data.values()) {\n            result.update(info.default());\n        }\n        return result.value;\n    }\n};\nLanguageFeatureDebounceService = __decorate([\n    __param(0, ILogService),\n    __param(1, IEnvironmentService)\n], LanguageFeatureDebounceService);\nexport { LanguageFeatureDebounceService };\nregisterSingleton(ILanguageFeatureDebounceService, LanguageFeatureDebounceService, 1 /* InstantiationType.Delayed */);\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n// ------ internal util\nexport var _util;\n(function (_util) {\n    _util.serviceIds = new Map();\n    _util.DI_TARGET = '$di$target';\n    _util.DI_DEPENDENCIES = '$di$dependencies';\n    function getServiceDependencies(ctor) {\n        return ctor[_util.DI_DEPENDENCIES] || [];\n    }\n    _util.getServiceDependencies = getServiceDependencies;\n})(_util || (_util = {}));\nexport const IInstantiationService = createDecorator('instantiationService');\nfunction storeServiceDependency(id, target, index) {\n    if (target[_util.DI_TARGET] === target) {\n        target[_util.DI_DEPENDENCIES].push({ id, index });\n    }\n    else {\n        target[_util.DI_DEPENDENCIES] = [{ id, index }];\n        target[_util.DI_TARGET] = target;\n    }\n}\n/**\n * The *only* valid way to create a {{ServiceIdentifier}}.\n */\nexport function createDecorator(serviceId) {\n    if (_util.serviceIds.has(serviceId)) {\n        return _util.serviceIds.get(serviceId);\n    }\n    const id = function (target, key, index) {\n        if (arguments.length !== 3) {\n            throw new Error('@IServiceName-decorator can only be used to decorate a parameter');\n        }\n        storeServiceDependency(id, target, index);\n    };\n    id.toString = () => serviceId;\n    _util.serviceIds.set(serviceId, id);\n    return id;\n}\n","import { createDecorator } from '../../instantiation/common/instantiation.js';\nexport const IEnvironmentService = createDecorator('environmentService');\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nexport function clamp(value, min, max) {\n    return Math.min(Math.max(value, min), max);\n}\nexport class MovingAverage {\n    constructor() {\n        this._n = 1;\n        this._val = 0;\n    }\n    update(value) {\n        this._val = this._val + (value - this._val) / this._n;\n        this._n += 1;\n        return this._val;\n    }\n    get value() {\n        return this._val;\n    }\n}\nexport class SlidingWindowAverage {\n    constructor(size) {\n        this._n = 0;\n        this._val = 0;\n        this._values = [];\n        this._index = 0;\n        this._sum = 0;\n        this._values = new Array(size);\n        this._values.fill(0, 0, size);\n    }\n    update(value) {\n        const oldValue = this._values[this._index];\n        this._values[this._index] = value;\n        this._index = (this._index + 1) % this._values.length;\n        this._sum -= oldValue;\n        this._sum += value;\n        if (this._n < this._values.length) {\n            this._n += 1;\n        }\n        this._val = this._sum / this._n;\n        return this._val;\n    }\n    get value() {\n        return this._val;\n    }\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nexport class SyncDescriptor {\n    constructor(ctor, staticArguments = [], supportsDelayedInstantiation = false) {\n        this.ctor = ctor;\n        this.staticArguments = staticArguments;\n        this.supportsDelayedInstantiation = supportsDelayedInstantiation;\n    }\n}\n"],"names":["_registry","registerSingleton","id","ctorOrDescriptor","supportsDelayedInstantiation","SyncDescriptor","Boolean","push","getSingletonServiceDescriptors","__param","paramIndex","decorator","target","key","ILanguageFeatureDebounceService","createDecorator","IdentityHash","_hashes","WeakMap","pool","of","obj","value","get","undefined","set","NullDebounceInformation","constructor","_default","this","_model","update","_value","FeatureDebounceInformation","_logService","_name","_min","_max","_cache","LRUCache","_key","model","all","reduce","hashVal","doHash","avg","clamp","default","SlidingWindowAverage","newValue","matchesScheme","uri","trace","toString","_overall","result","MovingAverage","LanguageFeatureDebounceService","envService","_data","Map","_isDev","isExtensionDevelopment","isBuilt","feature","name","config","min","max","extra","info","debug","_overallAverage","values","decorators","desc","d","c","arguments","length","r","Object","getOwnPropertyDescriptor","Reflect","decorate","i","defineProperty","__decorate","ILogService","IEnvironmentService","_util","serviceIds","DI_TARGET","DI_DEPENDENCIES","getServiceDependencies","ctor","IInstantiationService","serviceId","has","index","Error","storeServiceDependency","Math","_n","_val","size","_values","_index","_sum","Array","fill","oldValue","staticArguments"],"ignoreList":[],"sourceRoot":""}